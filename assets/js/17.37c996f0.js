(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{382:function(s,t,a){"use strict";a.r(t);var n=a(45),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("ol",[a("li",[s._v("应用模块遇到要发送事务消息的场景时，先发送"),a("code",[s._v("半消息")]),s._v("给 MQ Server。")]),s._v(" "),a("li",[s._v("MQ Server返回"),a("code",[s._v("半消息")]),s._v("收到通知,MQ发送方得知半消息发送成功，应用模块执行数据库事务（本地事务）。")]),s._v(" "),a("li",[s._v("MQ发送方 根据数据库事务执行的结果，再返回Commit或Rollback给 MQ Server。")]),s._v(" "),a("li",[s._v("如果是Commit，MQ Server 把消息下发给Consumer端，如果是Rollback，直接删掉向下传递的"),a("code",[s._v("半消息")]),s._v("。")]),s._v(" "),a("li",[s._v("第3步的执行结果如果没响应，或是超时的，"),a("code",[s._v("MQ Server")]),s._v(" 启动定时任务回查事务状态（最多重试15次，超过了默认丢弃此消息），处理结果同第4步。")]),s._v(" "),a("li",[s._v("MQ消费的成功机制由MQ自己保证。")])]),s._v(" "),a("p",[s._v("https://blog.csdn.net/ming19951224/article/details/109063041")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161908927.png",alt:"image-20210614143838730"}})]),s._v(" "),a("h2",{attrs:{id:"rockermq-docker-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rockermq-docker-安装"}},[s._v("#")]),s._v(" rockermq docker 安装")]),s._v(" "),a("p",[s._v("1、设置映射文件目录和配置文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("----rocketmq\n---------docker-compose.yml\n---------conf\n-------------broker.conf\n\n---------namesrv\n-------------store\n-------------logs\n\n---------broker\n-------------store\n-------------logs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("broker.conf")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Licensed to the Apache Software Foundation (ASF) under one or more")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# contributor license agreements.  See the NOTICE file distributed with")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this work for additional information regarding copyright ownership.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The ASF licenses this file to You under the Apache License, Version 2.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# (the "License"); you may not use this file except in compliance with')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the License.  You may obtain a copy of the License at")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     http://www.apache.org/licenses/LICENSE-2.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  Unless required by applicable law or agreed to in writing, software")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#  distributed under the License is distributed on an "AS IS" BASIS,')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  See the License for the specific language governing permissions and")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  limitations under the License.")]),s._v("\n \n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所属集群名字")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerClusterName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("DefaultCluster")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# broker 名字，注意此处不同的配置文件填写的不一样，如果在 broker-a.properties 使用: broker-a,")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在 broker-b.properties 使用: broker-b")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("broker-a")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0 表示 Master，> 0 表示 Slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("0")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nameServer地址，分号分割")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# namesrvAddr=rocketmq-nameserver1:9876;rocketmq-nameserver2:9876")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动IP,如果 docker 报 com.alibaba.rocketmq.remoting.exception.RemotingConnectException: connect to <192.168.0.120:10909> failed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解决方式1 加上一句 producer.setVipChannelEnabled(false);，解决方式2 brokerIP1 设置宿主机IP，不要使用docker 内部IP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerIP1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("192.168.1.100")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在发送消息时，自动创建服务器不存在的topic，默认创建的队列数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("defaultTopicQueueNums")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("4")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用 RocketMQ 进行发消息时，必须要指定 topic，对于 topic 的设置有一个开关autoCreateTopicEnable，一般在开发测试环境中会使用默认设置autoCreateTopicEnable = true，但是这样就会导致 topic 的设置不容易规范管理，没有统一的审核等等，所以在正式环境中会在 Broker 启动时设置参数autoCreateTopicEnable = false。这样当需要增加 topic 时就需要在 web 管理界面上添加即可。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许 Broker 自动创建 Topic，建议线下开启，线上关闭 ！！！这里仔细看是 false，false，false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("autoCreateTopicEnable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否允许 Broker 自动创建订阅组，建议线下开启，线上关闭")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("autoCreateSubscriptionGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("true")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Broker 对外服务的监听端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("listenPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("10911")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除文件时间点，默认凌晨4点")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("deleteWhen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("04")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件保留时间，默认48小时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("fileReservedTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("120")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# commitLog 每个文件的大小默认1G")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapedFileSizeCommitLog")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("1073741824")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ConsumeQueue 每个文件默认存 30W 条，根据业务情况调整")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapedFileSizeConsumeQueue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("300000")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# destroyMapedFileIntervalForcibly=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redeleteHangedFileInterval=120000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测物理文件磁盘空间")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("diskMaxUsedSpaceRatio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# storePathRootDir=/home/ztztdata/rocketmq-all-4.1.0-incubating/store")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# commitLog 存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# storePathCommitLog=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/commitlog")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 消费队列存储")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# storePathConsumeQueue=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/consumequeue")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 消息索引存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# storePathIndex=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/index")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# checkpoint 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# storeCheckpoint=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/checkpoint")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# abort 文件存储路径")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# abortFile=/home/ztztdata/rocketmq-all-4.1.0-incubating/store/abort")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限制的消息大小")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("maxMessageSize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("65536")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flushCommitLogLeastPages=4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flushConsumeQueueLeastPages=2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flushCommitLogThoroughInterval=10000")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# flushConsumeQueueThoroughInterval=60000")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Broker 的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - ASYNC_MASTER 异步复制Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - SYNC_MASTER 同步双写Master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - SLAVE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("brokerRole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ASYNC_MASTER")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 刷盘方式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - ASYNC_FLUSH 异步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - SYNC_FLUSH 同步刷盘")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("flushDiskType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("ASYNC_FLUSH")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sendMessageThreadPoolNums=128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉消息线程池数量")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pullMessageThreadPoolNums=128")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br")])]),a("p",[s._v("docker-compose.yml")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3.5"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmqnamesrv")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" foxiswho/rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4.7.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rmqnamesrv\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 9876"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#换成自己的本地映射目录")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./rmqs/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/opt/logs\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./rmqs/store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/opt/store\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("JAVA_OPT_EXT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Duser.home=/opt -Xms512M -Xmx512M -Xmn128m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mqnamesrv"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rmqnamesrv\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmqbroker")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" foxiswho/rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4.7.0\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rmqbroker\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10909"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 10911"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#换成自己的本地映射目录")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./rmq/logs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/opt/logs\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./rmq/store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/opt/store\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ./rmq/brokerconf/broker.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/rocketmq/broker.conf\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("JAVA_OPT_EXT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Duser.home=/opt -Xms512M -Xmx512M -Xmn128m"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mqbroker"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/rocketmq/broker.conf"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rmqnamesrv:9876"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"autoCreateTopicEnable=true"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rmqnamesrv\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rmqbroker\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmqconsole")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" styletang/rocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ng\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rmqconsole\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 8088"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("JAVA_OPTS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Drocketmq.namesrv.addr=rmqnamesrv:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rmqnamesrv\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("aliases")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" rmqconsole\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rmq")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rmq\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bridge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br")])]),a("p",[s._v("启动，在docker-compose.yml 目录下")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose up -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("访问console页面端口 http://192.168.1.100:8088/")]),s._v(" "),a("h2",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("应用解耦")])]),s._v(" "),a("li",[a("p",[s._v("流量削峰")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161909959.png",alt:"image-20210613191230550"}})])]),s._v(" "),a("li",[a("p",[s._v("数据分发")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161909947.png",alt:"111"}})])])]),s._v(" "),a("p",[s._v("优缺点")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161909408.png",alt:"image-20210613191811752"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161909001.png",alt:"image-20210613192140027"}})]),s._v(" "),a("p",[s._v("消息队列的组成")]),s._v(" "),a("ul",[a("li",[s._v("Broker\n消息服务器，作为server提供消息核心服务")]),s._v(" "),a("li",[s._v("Producer\n消息生产者，业务的发起方，生产消息传输给broker")]),s._v(" "),a("li",[s._v("Consumer\n消息消费者，业务处理方，负责从broker获取消息并进行业务逻辑处理")]),s._v(" "),a("li",[s._v("Topic\n主题，发布订阅模式下的消息统一汇集地，不同生产者向topic发送消息，由MQ服务器分发到不同的订阅者，实现消息")]),s._v(" "),a("li",[s._v("Queue\n队列，点对点模式下，特定生产者向特定queue发送消息，消费者订阅特定的queue完成指定消息的接收")]),s._v(" "),a("li",[s._v("Message\n消息体，根据不同通信协议定义的固定格式编码数据包，来封装业务数据，实现消息的传输。")])]),s._v(" "),a("h3",{attrs:{id:"rocketmq基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq基本概念"}},[s._v("#")]),s._v(" RocketMq基本概念")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("名称服务器")]),s._v("\n名称服务器（NameServer）用来保存 Broker 相关元信息并给 Producer 和 Consumer 查找 Broker 信息。NameServer 被设计成几乎无状态的，可以横向扩展，节点之间相互之间无通信，通过部署多台机器来标记自己是一个伪集群。每个 Broker 在启动的时候会到 NameServer 注册，Producer 在发送消息前会根据 Topic 到 NameServer 获取到 Broker 的路由信息，Consumer 也会定时获取 Topic 的路由信息。所以从功能上看应该是和 ZooKeeper 差不多，据说 RocketMQ 的早期版本确实是使用的 ZooKeeper ，后来改为了自己实现的 NameServer")]),s._v(" "),a("li",[s._v("消息\n消息（Message）就是要传输的信息。一条消息必须有一个主题（Topic），主题可以看做是你的信件要邮寄的地址。一条消息也可以拥有一个可选的标签（Tag）和额处的键值对，它们可以用于设置一个业务 key 并在 Broker 上查找此消息以便在开发期间查找问题。")]),s._v(" "),a("li",[s._v("主题\n主题（Topic）可以看做消息的规类，它是消息的第一级类型。比如一个电商系统可以分为：交易消息、物流消息等，一条消息必须有一个 Topic 。Topic 与生产者和消费者的关系非常松散，一个 Topic 可以有0个、1个、多个生产者向其发送消息，一个生产者也可以同时向不同的 Topic 发送消息。一个 Topic 也可以被 0个、1个、多个消费者订阅")]),s._v(" "),a("li",[a("strong",[s._v("消息服务器")]),s._v("\n消息服务器（Broker）是消息存储中心，主要作用是接收来自 Producer 的消息并存储， Consumer 从这里取得消息。它还存储与消息相关的元数据，包括用户组、消费进度偏移量、队列信息等。从部署结构图中可以看出 Broker 有 Master 和 Slave 两种类型，Master 既可以写又可以读，Slave 不可以写只可以读。从物理结构上看 Broker 的集群部署方式有四种：单 Master 、多 Master 、多 Master 多 Slave（同步刷盘）、多 Master多 Slave（异步刷盘）。")]),s._v(" "),a("li",[s._v("生产者组\n生产者组（Producer Group）是一类 Producer 的集合，这类 Producer 通常发送一类消息并且发送逻辑一致，所以将这些 Producer 分组在一起。从部署结构上看生产者通过 Producer Group 的名字来标记自己是一个集群")]),s._v(" "),a("li",[s._v("消息队列\n消息队列（Message Queue），主题被划分为一个或多个子主题，即消息队列。一个 Topic 下可以设置多个消息队列，发送消息时执行该消息的 Topic ，RocketMQ 会轮询该 Topic 下的所有队列将消息发出去。下图 Broker 内部消息情况：")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/ChetWei/img/raw/master/img/202109161909491.png",alt:"image-20210613210759643"}})]),s._v(" "),a("h3",{attrs:{id:"rocketmq-环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-环境搭建"}},[s._v("#")]),s._v(" RocketMQ 环境搭建")]),s._v(" "),a("p",[s._v("docker 安装")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker pull rocketmqinc/rocketmq\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动namesrv")]),s._v("\n\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v(":9876 -v /E/docker-v/rocketmq/data/namesrv/logs:/root/logs -v /E/docker-v/rocketmq/data/namesrv/store:/root/store --name rmqnamesrv -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MAX_POSSIBLE_HEAP=100000000"')]),s._v(" rocketmqinc/rocketmq "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqnamesrv\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#启动broker")]),s._v("\ndocker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v(":10911 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v(":10909 -v  /E/docker-v/rocketmq/data/broker/logs:/root/logs -v  /E/docker-v/rocketmq/data/broker/store:/root/store  -v /E/docker-v/rocketmq/conf/broker.conf:/opt/rocketmq/conf/broker.conf --name rmqbroker -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMESRV_ADDR=namesrv:9876"')]),s._v(" -e "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MAX_POSSIBLE_HEAP=200000000"')]),s._v(" rocketmqinc/rocketmq "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /opt/rocketmq/conf/broker.conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"rocketmq-高可用集群环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-高可用集群环境"}},[s._v("#")]),s._v(" RocketMQ 高可用集群环境")]),s._v(" "),a("h3",{attrs:{id:"基本样例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本样例"}},[s._v("#")]),s._v(" 基本样例")]),s._v(" "),a("p",[s._v("https://github.com/apache/rocketmq/blob/master/docs/cn/RocketMQ_Example.md")]),s._v(" "),a("p",[s._v("使用消息生产者分别通过三种方式发送消息，同步发送，异步发送，单向发送")])])}),[],!1,null,null,null);t.default=e.exports}}]);